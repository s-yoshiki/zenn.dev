---
title: "JSã§ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯ã®è¨ˆç®—"
emoji: ðŸŒ
type: tech
topics: ["javascript","node","ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ "]
published: false
---

## æ¦‚è¦

JSã§IPv4ã®ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯ã®è¨ˆç®—ã‚’è¡Œã£ãŸæ™‚ã®è¨˜éŒ²åŠã³è‡ªåˆ†ç”¨ãƒ¡ãƒ¢ã§ã™ã€‚

JSã§IPã®è¨ˆç®—ã‚’è¡Œã†æ©Ÿä¼šãªã‚“ã¦æ®†ã©ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€(node.jsã¯åˆ¥ã¨ã—ã¦)
é‡è¦ãªç†è«–ã‚’æ•´ç†ã™ã‚‹ãŸã‚ã«JSã§å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚

## JSã«ã‚ˆã‚‹ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯é–¢é€£ã®è¨ˆç®—

å¤§å‰æã¨ã—ã¦ã‚µãƒ–ãƒãƒƒãƒˆã®è¨ˆç®—ã‚’æ•´ç†ã—ã¦ãŠãã¾ã™ã€‚

â€» ã“ã“ã«è¨˜è¼‰ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã¯"æœ€ä½Žé™ã®æ©Ÿèƒ½"ã—ã‹å®Ÿè£…ã—ã¦ãŠã‚‰ãšã€å…¥åŠ›å€¤ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹æ©Ÿæ§‹ã¯ãªã„ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ä¾‹å¤–çš„ãªå€¤ã‚’å…¥åŠ›ã™ã‚‹ã¨èª¤ä½œå‹•ã—ã¾ã™ã€‚

### IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹æ–‡å­—åˆ—ã‚’Numberåž‹ã«å¤‰æ›ã™ã‚‹

IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ–‡å­—åˆ—ã€ä¾‹ãˆã° `192.168.0.1` ã®ã‚ˆã†ãªå½¢å¼ã®æ–‡å­—åˆ—ã‚’è¨ˆç®—ã§åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã€Numberåž‹ã«å¤‰æ›ã—ã¦ãŠãã¾ã™ã€‚å¾Œã€…bitæ¼”ç®—ã™ã‚‹ã®ãŒæ¥½ã§ã™ã€‚

```js
// IPv4 to binary string
const ip2bin = (ip) => ip.split(".").map(e => Number(e).toString(2).padStart(8, '0')).join('')
// IPv4 to Number
const ip2long = (ip) => parseInt(ip2bin(ip), 2)
// Number to IPv4
const long2ip = (num) => {
    let bin = Number(num).toString(2).padStart(32, '0')
    return [
        bin.slice(0, 8),
        bin.slice(8, 16),
        bin.slice(16, 24),
        bin.slice(24, 32),
    ].map(e => parseInt(e, 2)).join('.')
}

console.log(ip2bin("192.0.34.166")) // 11000000000000000010001010100110
console.log(ip2long("192.0.34.166")) // 3221234342
console.log(long2ip(ip2long("192.0.34.166"))) // 192.0.34.166
```

ä½™è«‡ã§ã™ãŒã€ip2long/long2ipã¯PHPã§åŒã˜åå‰ã®é–¢æ•°ãŒå­˜åœ¨ã—ã¾ã™ã€‚ã“ã“ã‹ã‚‰åå‰ã‚’æ‹å€Ÿã—ã¾ã—ãŸã€‚

[ip2long - php.net](https://www.php.net/manual/ja/function.ip2long.php)

### CIDR ã¨ ã‚µãƒ–ãƒãƒƒãƒˆã®ç›¸äº’å¤‰æ›

CIDRã¯2é€²æ•°ã§è¡¨ç¤ºã•ã‚ŒãŸå ´åˆã®å…ˆé ­ã‹ã‚‰ã®1ã®æ•°ã‚’è¡¨ã—ã¦ãŠã‚Šã€1ã€œ32ã®å€¤ã¨ãªã‚Šã¾ã™ã€‚

ãªã®ã§æ¬¡ã®ã‚ˆã†ãªé–¢ä¿‚ãŒæˆã‚Šç«‹ã¡ã¾ã™ã€‚

```
26 (CIDR)
â†“
1111111,1111111,1111111,11000000 (2é€²æ•°è¡¨è¨˜)
â†“
255.255.255.192 (10é€²æ•°è¡¨è¨˜ã€ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯)
```

ã‚³ãƒ¼ãƒ‰ã«ã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js
// CIDR to Number
const cidr2long = (cidr) => parseInt(String("").padStart(cidr, '1').padEnd(32, '0'), 2)
// CIDR to SubnetMask
const cidr2subnetmask = (num) => long2ip(cidr2long(num))
// SubnetMask to CIDR
const subnetmask2cidr = (ip) => ip2bin(ip).split('1').length - 1

console.log(cidr2subnetmask(26)) // 255.255.255.192
console.log(subnetmask2cidr("255.255.255.192")) // 26
```

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ ã¨ ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹(é–‹å§‹ã‚¢ãƒ‰ãƒ¬ã‚¹)ã¯ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯ã®AND(è«–ç†ç©)ã§æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚

ã¾ãŸã€ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹(çµ‚äº†ã‚¢ãƒ‰ãƒ¬ã‚¹)ã¯ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨åè»¢ã—ãŸã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯ã®OR(è«–ç†å’Œ)ã§æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚

ã‚¤ãƒ¡ãƒ¼ã‚¸ã ã¨ã“ã‚“ãªæ„Ÿã˜ã§ã™â†“

```js
ip & subnetmask // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹
ip | ~subnetmask // ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹
```

ãªã®ã§ã€ç´”ç²‹ã«JSã®ãƒ“ãƒƒãƒˆè«–ç†ç©ã¨ãƒ“ãƒƒãƒˆè«–ç†å’Œã§è¨ˆç®—ã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€ã€ã€ã“ã“ã§ãƒãƒžã‚Šã¾ã—ãŸã€‚

```js
console.log(64) // 64
console.log(64 | 0) // 64
console.log(ip2long("192.168.0.1")) // 3232235521
console.log(3232235521) // 3232235521
console.log(3232235521 | 0) // -1062731775
```

ã“ã“ã«ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã®5è¡Œç›®ã‚ˆã†ã«ã€è¨ˆç®—ä¸­ã«æ„å›³ã›ãšè² ã®å€¤ã¨ãªã£ã¦ã„ã¾ã—ãŸã€‚
ã“ã‚Œã¯2ã®è£œæ•°(=ç¬¦å·ä»˜ã32ãƒ“ãƒƒãƒˆã®æ•´æ•°)ã¨ã—ã¦è¡¨ç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚
ç¬¦å·ä»˜ã32ãƒ“ãƒƒãƒˆæ•´æ•°ã¯ -2ã®32ä¹—ã‹ã‚‰2ã®32ä¹—-1ã‚’è¡¨ç¾ã§ãã¾ã™ã€‚

ä»Šå›žã¯32ãƒ“ãƒƒãƒˆã§è¡¨ã›ã‚‹æ•°å€¤ã‚’å…¨ã¦ç¬¦å·ãªã—ã®æ•´æ•°ã¨ã—ã¦è¡¨ç¾ã—ãŸã‹ã£ãŸã®ã§ã€å¤‰æ›ã™ã‚‹æ–¹æ³•ã‚’æŽ¢ã—ãŸã¨ã“ã‚ "ç¬¦å·ãªã—å³ã‚·ãƒ•ãƒˆæ¼”ç®—å­" ã§ç¬¦å·ãªã—ã®è¡¨ç¾ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```js
console.log(3232235521) // 3232235521
console.log(3232235521 >>> 0) // 3232235521
```

ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ¬¡ã®ã‚ˆã†ã«æ±‚ã‚ã¾ã™ã€‚

```js
// ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹
const getNetworkAddr = (ip, subnetmask) => (ip & subnetmask) >>> 0
// ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹
const getBroadcastAddr = (ip, subnetmask) => (ip | ~subnetmask) >>> 0
```

### ã‚¯ãƒ©ã‚¹

IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä½¿ç”¨ã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¦æ¨¡ã«ã‚ˆã£ã¦ã‚¯ãƒ©ã‚¹Aã€œCã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚

 - **ã‚¯ãƒ©ã‚¹A** 10.0.0.0 ï½ž 10.255.255.255
 - **ã‚¯ãƒ©ã‚¹B** 172.16.0.0 ï½ž 172.31.255.255
 - **ã‚¯ãƒ©ã‚¹C** 192.168.0.0 ï½ž 192.168.255.255

ã“ã‚Œã‚’æ¬¡ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã«è½ã¨ã—ã¾ã—ãŸã€‚

```js
const getClass = (ip) => {
    if (ip2long("10.0.0.0") <= ip && ip <= ip2long("10.255.255.255")) {
        return 'A'
    }
    if (ip2long("172.16.0.0") <= ip && ip <= ip2long("172.31.255.255")) {
        return 'B'
    }
    if (ip2long("192.168.0.0") <= ip && ip <= ip2long("192.168.255.255")) {
        return 'C'
    }
    return false;
}
console.log(getClass(ip2long("192.168.0.1"))) // C
```

## æ”¹ã‚ã¦ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯ã‚’è¨ˆç®—ã™ã‚‹

æ”¹ã‚ã¦æ•´ç†ã—ã¦ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯ã®è¨ˆç®—ã‚’è¡Œã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰å…¨ã¦è¼‰ã›ã¾ã™ã€‚

```js
const ip2bin = (ip) => ip.split(".").map(e => Number(e).toString(2).padStart(8, '0')).join('')

const ip2long = (ip) => parseInt(ip2bin(ip), 2)

const long2ip = (num) => {
    let bin = Number(num).toString(2).padStart(32, '0')
    return [
        bin.slice(0, 8),
        bin.slice(8, 16),
        bin.slice(16, 24),
        bin.slice(24, 32),
    ].map(e => parseInt(e, 2)).join('.')
}

const cidr2long = (cidr) => parseInt(String("").padStart(cidr, '1').padEnd(32, '0'), 2)

const cidr2subnetmask = (num) => long2ip(cidr2long(Number(num)))

const subnetmask2cidr = (ip) => ip2bin(ip).split('1').length - 1

const getNetworkAddr = (ip, subnetmask) => (ip & subnetmask) >>> 0

const getBroadcastAddr = (ip, subnetmask) => (ip | ~subnetmask) >>> 0

const getClass = (ip) => {
    if (ip2long("10.0.0.0") <= ip && ip <= ip2long("10.255.255.255")) {
        return 'A'
    }
    if (ip2long("172.16.0.0") <= ip && ip <= ip2long("172.31.255.255")) {
        return 'B'
    }
    if (ip2long("192.168.0.0") <= ip && ip <= ip2long("192.168.255.255")) {
        return 'C'
    }
    return false;
}

const ip = "192.168.0.1"
console.log(`
IPã‚¢ãƒ‰ãƒ¬ã‚¹: ${ip}
ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯: /${subnetmask2cidr("255.255.255.0")} (${cidr2subnetmask(24)})
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹: ${long2ip(getNetworkAddr(ip2long(ip), cidr2long(24)))}
ä½¿ç”¨å¯èƒ½IP: ${long2ip(getNetworkAddr(ip2long(ip), cidr2long(24)) + 1)} ã€œ ${long2ip(getBroadcastAddr(ip2long(ip), cidr2long(24)) - 1)}
ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹: ${long2ip(getBroadcastAddr(ip2long(ip), cidr2long(24)))}
ã‚¢ãƒ‰ãƒ¬ã‚¹æ•°: ${getBroadcastAddr(ip2long(ip), cidr2long(24)) - getNetworkAddr(ip2long(ip), cidr2long(24)) + 1}
ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹æ•°: ${getBroadcastAddr(ip2long(ip), cidr2long(24)) - getNetworkAddr(ip2long(ip), cidr2long(24)) - 1}
IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚¯ãƒ©ã‚¹: ${getClass(ip2long(ip))}
`)
```

ãã—ã¦å‡ºåŠ›çµæžœãŒã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚ã‚µãƒ–ãƒãƒƒãƒˆè¨ˆç®—ã‚µã‚¤ãƒˆã®çµæžœã¨ä¸€è‡´ã—ã¾ã—ãŸã€‚

```
IPã‚¢ãƒ‰ãƒ¬ã‚¹: 192.168.0.1
ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯: /24 (255.255.255.0)
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹: 192.168.0.0
ä½¿ç”¨å¯èƒ½IP: 192.168.0.1 ã€œ 192.168.0.254
ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹: 192.168.0.255
ã‚¢ãƒ‰ãƒ¬ã‚¹æ•°: 256
ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹æ•°: 254
IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚¯ãƒ©ã‚¹: C
```

## å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã‚µã‚¤ãƒˆ

[ã‚µãƒ–ãƒãƒƒãƒˆãƒžã‚¹ã‚¯ã¨ã¯ï¼Ÿ - CMAN](https://www.cman.jp/network/term/subnet/)

[JavaScriptã®ãƒ“ãƒƒãƒˆæ¼”ç®—ãªç½ ](http://katwat.s1005.xrea.com/wp/5164)

[ç¬¦å·ãªã—å³ã‚·ãƒ•ãƒˆ (>>>) - MDN ](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Unsigned_right_shift)

[32ãƒ“ãƒƒãƒˆ - Wikipedia](https://ja.wikipedia.org/wiki/32%E3%83%93%E3%83%83%E3%83%88)